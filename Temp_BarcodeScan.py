from nicegui import ui

def main():
    all_keys = []                         # –ü–æ–ª–Ω—ã–π –±—É—Ñ–µ—Ä –¥–ª—è –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
    termination_sequence = ";'"           # –ó–∞–≤–µ—Ä—à–∞—é—â–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

    # –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ
    dialog = ui.dialog()

    with dialog.props('persistent') as dialog, ui.card():
        ui.label('–í–≤–µ–¥–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã...')
        result_label = ui.label()
        # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞
        ui.button('–ó–∞–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥', on_click=lambda: close_dialog())

    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à
    def on_key(e):
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –∫–ª–∞–≤–∏—à–∏ (keyup)
        if not e.action.keyup:
            return

        key_str = str(e.key)
        if len(key_str) != 1 or not key_str.isprintable():
            return

        # –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ –æ–±—â–∏–π –±—É—Ñ–µ—Ä
        all_keys.append(key_str)
        print("–ù–∞–±—Ä–∞–Ω–æ: ", "".join(all_keys))
        
        # –ï—Å–ª–∏ –¥–ª–∏–Ω–∞ –±—É—Ñ–µ—Ä–∞ –º–µ–Ω—å—à–µ –¥–ª–∏–Ω—ã –∑–∞–≤–µ—Ä—à–∞—é—â–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ç–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–±–æ—Ä
        if len(all_keys) < len(termination_sequence):
            return
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –ª–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã –∑–∞–≤–µ—Ä—à–∞—é—â–µ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
        if "".join(all_keys[-len(termination_sequence):]) == termination_sequence:
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∏—Å–∫–ª—é—á–∞—è –∑–∞–≤–µ—Ä—à–∞—é—â—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            result = "".join(all_keys[:-len(termination_sequence)])
            result_label.text = f'üéâ –í—ã –Ω–∞–±—Ä–∞–ª–∏: {result}'
            # –û—Ç–∫–ª—é—á–∞–µ–º –¥–∞–ª—å–Ω–µ–π—à—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∞–≤–∏—à (–º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –æ—á–∏—Å—Ç–∏—Ç—å –±—É—Ñ–µ—Ä, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
            keyboard.active = False

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –≤—ã–∫–ª—é—á–∞–µ–º –µ–≥–æ –¥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞
    keyboard = ui.keyboard(on_key)
    keyboard.active = False

    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å –∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π —Ç—Ä–µ–∫–∏–Ω–≥–∞ –∫–ª–∞–≤–∏—à
    def open_dialog():
        all_keys.clear()         # –°–±—Ä–æ—Å –±—É—Ñ–µ—Ä–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –¥–∏–∞–ª–æ–≥–∞
        keyboard.active = True   # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∞–≤–∏—à
        dialog.open()

    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞ —Å –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏–µ–π —Ç—Ä–µ–∫–∏–Ω–≥–∞ –∫–ª–∞–≤–∏—à
    def close_dialog():
        keyboard.active = False  # –û—Ç–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∞–≤–∏—à
        dialog.close()

    # –ö–Ω–æ–ø–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –¥–∏–∞–ª–æ–≥–∞
    ui.button('–û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥', on_click=open_dialog)

if __name__ in {'__main__', '__mp_main__'}:
    main()
    ui.run()
