# CSV Export Functionality

## Обзор

Система аренды оборудования теперь поддерживает экспорт данных в формате CSV как в браузерном, так и в оконном режиме.

## Возможности экспорта

### 1. Экспорт отчетов
Все отчеты в системе имеют кнопку "Export to CSV":
- **Статистика пользователей** - данные об аренде по пользователям
- **Статистика типов оборудования** - данные об аренде по типам оборудования  
- **Статистика оборудования** - детальная статистика по каждому устройству
- **История аренды** - полная история всех операций аренды
- **Статистика отделов** - данные об аренде по отделам
- **Отзывы пользователей** - все отзывы и предложения



## Режимы работы

### Браузерный режим
- Файлы скачиваются через браузер в папку загрузок
- Используется стандартный механизм `ui.download()`
- Временные файлы автоматически удаляются

### Оконный режим (Native)
- Файлы автоматически сохраняются в папку Downloads
- При конфликте имен добавляется номер к имени файла
- Не требует дополнительных действий от пользователя
- При ошибках автоматически переключается на браузерный режим

## Формат файлов

Все CSV файлы:
- Используют кодировку UTF-8
- Содержат заголовки столбцов
- Имеют расширение `.csv`
- Автоматически получают имя с временной меткой

## Примеры имен файлов

- `user_rental_statistics_20241017_143052.csv`

- `rental_history_20241017_143052.csv`

## Технические детали

### Автоматическое определение режима
Система автоматически определяет, в каком режиме запущена:
```python
from nicegui import app
is_native = app.native.main_window is not None
```

### Обработка ошибок
- При недоступности tkinter в оконном режиме - переключение на браузерный режим
- При ошибках сохранения - уведомление пользователя
- Fallback механизмы для обеспечения работоспособности

### Структура данных
Каждый тип отчета имеет свою структуру CSV:

**Список оборудования:**
- name, serial_number, type, status, rented_by, department, rental_start, comment

**История аренды:**
- id, equipment, serialnum, equipment_type, user, department, rental_start, rental_end, duration, comment

**Статистика пользователей:**
- name, department, rental_count, total_rental_time

## Использование

1. **Для экспорта отчетов:** Откройте любой отчет и нажмите кнопку "Export to CSV"
2. **В оконном режиме:** Файл автоматически сохранится в папку Downloads
3. **В браузерном режиме:** Файл автоматически загрузится в папку загрузок

## Требования

- Python 3.7+
- tkinter (для оконного режима, обычно входит в стандартную поставку Python)
- NiceGUI
- Все остальные зависимости проекта